!function(t){var e={};function i(s){if(e[s])return e[s].exports;var r=e[s]={i:s,l:!1,exports:{}};return t[s].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)i.d(s,r,function(e){return t[e]}.bind(null,r));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=0)}([function(t,e,i){"use strict";i.r(e);const s=30,r=10,l=20,n=[[[0,0,0,0],[1,1,1,1],[0,0,0,0],[0,0,0,0]],[[2,0,0],[2,2,2],[0,0,0]],[[0,0,3],[3,3,3],[0,0,0]],[[4,4],[4,4]],[[0,5,5],[5,5,0],[0,0,0]],[[6,6,0],[0,6,6],[0,0,0]],[[0,7,0],[7,7,7],[0,0,0]]],h=["none","cyan","blue","orange","yellow","green","red","purple"],o=100,a=300,c=500,d=800,x={0:800,1:717,2:633,3:550,4:467,5:383,6:300,7:217,8:133,9:100,10:83,11:83,12:83,13:67,14:67,15:67,16:50,17:50,18:50,19:33};class u{constructor(t){this.ctx=t,this.tetrominoNumber=Math.floor(Math.random()*n.length),this.color=h[this.tetrominoNumber+1],this.shape=n[this.tetrominoNumber],this.x=0,this.y=-1}getStartPos(){this.x=3===this.tetrominoNumber?4:3}move(t){this.x=t.x,this.y=t.y,this.shape=t.shape}draw(){this.ctx.fillStyle=this.color,this.shape.forEach((t,e)=>{t.forEach((t,i)=>{t>0&&this.ctx.fillRect(this.x+i,this.y+e,1,1)})})}drawNext(){let t,e;switch(this.ctx.fillStyle=this.color,this.shape.length){case 4:t=0,e=.5;break;case 3:t=.5,e=.75;break;case 2:t=1,e=1}this.shape.forEach((i,s)=>{i.forEach((i,r)=>{i>0&&this.ctx.fillRect(t+r,e+s,1,1)})})}}class f{constructor(t,e){this.ctx=t,this.ctxNext=e,this.ctx.canvas.width=s*r,this.ctx.canvas.height=s*l,this.ctx.scale(s,s)}reset(){this.grid=this.getNewLevel(),this.tetromino=new u(this.ctx),this.tetromino.getStartPos(),this.getNextTetromino()}getNextTetromino(){this.nextTetromino=new u(this.ctxNext),this.ctxNext.clearRect(0,0,this.ctxNext.canvas.width,this.ctxNext.canvas.height),this.nextTetromino.drawNext()}getNewLevel(){return Array.from({length:20},()=>Array(10).fill(0))}gravity(){let t=this.tetromino;if(t.y+=1,this.isValidMove(t))this.tetromino.move(t);else{if(this.freeze(),this.lineClear(),0===this.tetromino.y)return!1;this.tetromino=this.nextTetromino,this.tetromino.ctx=this.ctx,this.tetromino.getStartPos(),this.getNextTetromino()}return!0}freeze(){this.tetromino.shape.forEach((t,e)=>{t.forEach((t,i)=>{t>0&&(this.grid[e+this.tetromino.y][i+this.tetromino.x]=t)})})}lineClear(){let t=0;this.grid.forEach((e,i)=>{e.every(t=>t>0)&&(t++,this.grid.splice(i,1),this.grid.unshift(Array(r).fill(0)))}),t>0&&(v.score+=this.getLineClearScore(t),v.lines+=t,v.levelProgress+=t,v.levelProgress>=10&&(v.level++,v.levelProgress-=10,m.interval=v.level>=29?17:v.level>19&&v.level<29?x[19]:x[v.level]))}getLineClearScore(t){switch(t){case 1:return o*(v.level+1);case 2:return a*(v.level+1);case 3:return c*(v.level+1);case 4:return d*(v.level+1)}}drawLevel(){this.grid.forEach((t,e)=>{t.forEach((t,i)=>{t>0&&(this.ctx.fillStyle=h[t],this.ctx.fillRect(i,e,1,1))})})}rotate(t,e){let i=JSON.parse(JSON.stringify(t));if("left"===e){i.shape.forEach(t=>t.reverse());for(let t=0;t<i.shape.length;++t)for(let e=0;e<t;++e)[i.shape[e][t],i.shape[t][e]]=[i.shape[t][e],i.shape[e][t]];if(this.isValidMove(i))return i}else if("right"===e){for(let t=0;t<i.shape.length;++t)for(let e=0;e<t;++e)[i.shape[e][t],i.shape[t][e]]=[i.shape[t][e],i.shape[e][t]];if(i.shape.forEach(t=>t.reverse()),this.isValidMove(i))return i}}isValidMove(t){return t.shape.every((e,i)=>e.every((e,s)=>{let r=t.x+s,l=t.y+i;return 0===e||this.insideWalls(r)&&this.aboveFloor(l)&&this.empty(r,l)}))}insideWalls(t){return t>=0&&t<r}aboveFloor(t){return t<l}empty(t,e){return this.grid[e]&&0===this.grid[e][t]}draw(){this.tetromino.draw(),this.drawLevel()}}let v=new Proxy({score:0,level:0,lines:0,levelProgress:0},{set:(t,e,i)=>(t[e]=i,function(t,e){let i=document.getElementById(t);i&&(i.textContent=e)}(e,i),!0)});let m={start:0,elapsed:0,interval:x[v.level]},p=document.getElementById("play-btn"),g=document.getElementById("pause-btn"),y=document.getElementById("help-btn");const w=document.getElementById("tetris"),b=document.getElementById("preview");new class{constructor(t,e){this.ctx=t.getContext("2d"),this.ctxNext=e.getContext("2d"),this.level=new f(this.ctx,this.ctxNext),this.inputHandler(),this.handleButtons(),this.initPreview(),this.requestId}initPreview(){this.ctxNext.canvas.width=4*s,this.ctxNext.canvas.height=4*s,this.ctxNext.scale(s,s)}handleButtons(){p.addEventListener("click",t=>{t.preventDefault(),p.classList.add("hidden"),g.classList.remove("hidden"),this.play()}),g.addEventListener("click",t=>{t.preventDefault(),this.pause(),this.showPause(),this.gameOver()}),y.addEventListener("click",t=>{t.preventDefault(),this.requestId&&this.pause(),this.showHelp()})}showPlay(){let t=document.getElementById("play-btn"),e=document.getElementById("pause-btn");t.classList.remove("hidden"),e.classList.add("hidden")}animate(t=0){if(m.elapsed=t-m.start,m.elapsed>m.interval&&(m.start=t,!this.level.gravity()))return this.gameOver(),this.showPlay(),cancelAnimationFrame(this.requestId);this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.level.draw(),this.requestId=requestAnimationFrame(this.animate.bind(this))}play(){this.reset(),this.requestId&&cancelAnimationFrame(this.requestId),this.animate()}pause(){if(!this.requestId)return this.animate(),void this.toggleButtonText();cancelAnimationFrame(this.requestId),this.toggleButtonText(),this.requestId=null}gameOver(){this.ctx.fillStyle="black",this.ctx.fillRect(.25,3.5,9.5,2.2),this.ctx.font="1px 'Press Start 2P'",this.ctx.fillStyle="red",this.ctx.fillText("GAME OVER",.6,5.2)}showPause(){this.ctx.fillStyle="black",this.ctx.fillRect(1,3.5,8,2.2),this.ctx.font="1px 'Press Start 2P'",this.ctx.fillStyle="red",this.ctx.fillText("PAUSED",2.1,5.2)}showHelp(){this.ctx.fillStyle="black",this.ctx.fillRect(.6,3.5,8.8,9),this.ctx.font=".8px 'Press Start 2P'",this.ctx.fillStyle="red",this.ctx.fillText("Controls",1,5.2),this.ctx.font=".5px 'Press Start 2P'",this.ctx.fillText("I = Hard Drop",1,6.2),this.ctx.fillText("J = Left",1,7.2),this.ctx.fillText("K = Soft Drop",1,8.2),this.ctx.fillText("L = Left",1,9.2),this.ctx.fillText("U = Rotate Left",1,10.2),this.ctx.fillText("O = Rotate Right",1,11.2)}toggleButtonText(){"Pause"===g.innerText?g.innerText="Resume":g.innerText="Pause"}reset(){v.score=0,v.level=0,v.lines=0,v.levelProgress=0,this.level.reset()}inputHandler(){document.addEventListener("keydown",this.keyDownHandler.bind(this),!1)}keyDownHandler(t){let e={i:t=>({...t,y:t.y+1}),j:t=>({...t,x:t.x-1}),k:t=>({...t,y:t.y+1}),l:t=>({...t,x:t.x+1}),u:t=>this.level.rotate(t,"left"),o:t=>this.level.rotate(t,"right")},i=t.key.toLowerCase();if("escape"===i&&this.pause(),e[i]){t.preventDefault();let s=e[i](this.level.tetromino);if("i"===i)for(;this.level.isValidMove(s);)this.level.tetromino.move(s),v.score+=2,s=e[i](this.level.tetromino);this.level.isValidMove(s)&&(this.level.tetromino.move(s),"k"===i&&v.score++)}}}(w,b)}]);